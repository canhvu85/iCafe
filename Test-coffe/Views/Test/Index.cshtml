@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>jqGrid - Ace Admin</title>

    <meta name="description" content="Dynamic tables and grids using jqGrid plugin" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

    <!-- bootstrap & fontawesome -->

    <link rel="stylesheet" href="~/ace-master/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/ace-master/assets/font-awesome/4.5.0/css/font-awesome.min.css" />

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="~/ace-master/assets/css/jquery-ui.min.css" />
    <link rel="stylesheet" href="~/ace-master/assets/css/bootstrap-datepicker3.min.css" />
    <link rel="stylesheet" href="~/ace-master/assets/css/ui.jqgrid.min.css" />

    <!-- text fonts -->
    @*<link rel="stylesheet" href="~/ace-master/assets/css/fonts.googleapis.com.css" />*@

    <!-- ace styles -->
    <link rel="stylesheet" href="~/ace-master/assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
    <![endif]-->
    @*<link rel="stylesheet" href="~/ace-master/assets/css/ace-skins.min.css" />
    <link rel="stylesheet" href="~/ace-master/assets/css/ace-rtl.min.css" />*@

    <!--[if lte IE 9]>
      <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
    <![endif]-->
    <!-- inline styles related to this page -->
    <!-- ace settings handler -->
    @*<script src="~/ace-master/assets/js/ace-extra.min.js"></script>*@

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->
    <!--[if lte IE 8]>
    <script src="assets/js/html5shiv.min.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->
</head>

<body class="no-skin">
    <div class="page-content">
        <div class="row">
            <div class="col-xs-12">
                <!-- PAGE CONTENT BEGINS -->
                <table id="grid-table"></table>

                <div id="grid-pager"></div>

                <!-- PAGE CONTENT ENDS -->
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.page-content -->
    <!-- basic scripts -->
    <!--[if !IE]> -->
    <script src="~/ace-master/assets/js/jquery-2.1.4.min.js"></script>
    <script src="~/ace-master/assets/js/bootstrap.min.js"></script>
    <script src="~/ace-master/assets/js/jquery.jqGrid.min.js"></script>
    <script src="~/ace-master/assets/js/grid.locale-en.js"></script>

    <script type="text/javascript">
        jQuery(function ($) {
            var grid_selector = "#grid-table";
            var pager_selector = "#grid-pager";

            var parent_column = $(grid_selector).closest('[class*="col-"]');
            //resize to fit page size
            $(window).on('resize.jqGrid', function () {
                $(grid_selector).jqGrid('setGridWidth', parent_column.width());
            })

            jQuery(grid_selector).jqGrid({
                subGrid: true,
                subGridOptions: {
                    plusicon: "ace-icon fa fa-plus center bigger-110 blue",
                    minusicon: "ace-icon fa fa-minus center bigger-110 blue",
                    openicon: "ace-icon fa fa-chevron-right center orange"
                },
                subGridRowExpanded: function (subgridDivId, rowId) {
                    var subgridTableId = subgridDivId + "_t";
                    $("#" + subgridDivId).html("<table id='" + subgridTableId + "'></table>");
                    $("#" + subgridTableId).jqGrid({
                        url: "https://localhost:5001/api/BillDetailsAPI/bills/" + rowId,
                        datatype: "json",
                        colNames: ['productsName', 'price', 'quantity', 'total'],
                        colModel: [
                            { name: "productsName", index: "productsName", width: 80 },
                            { name: "price", index: "price", width: 130 },
                            { name: "quantity", index: "quantity", width: 70, align: "right" },
                            { name: "total", index: "total", width: 70, align: "right" }
                        ],
                        autowidth: true
                    });
                },
                url: 'https://localhost:5001/api/BillsAPI/?TableId=1',
                datatype: "json",
                height: 250,
                colNames: ['id', 'tablesName', 'created_by', 'sub_total', 'fee_service', 'total_money'],
                colModel: [

                    { name: 'id', index: 'id', width: 55 },
                    { name: 'tablesName', index: 'tablesName', width: 90 },
                    { name: 'created_by', index: 'created_by', width: 100 },
                    { name: 'sub_total', index: 'sub_total', width: 80 },
                    { name: 'fee_service', index: 'fee_service', width: 80 },
                    { name: 'total_money', index: 'total_money', width: 80, sortable: false }
                ],
                loadonce: true,
                rowNum: 2,
                rowList: [2, 5, 30],
                pager: pager_selector,
                loadComplete: function () {
                    var table = this;
                    setTimeout(function () {
                        updatePagerIcons(table);
                    }, 0);
                },
                caption: "jqGrid with inline editing"
            });
            $(window).triggerHandler('resize.jqGrid');//trigger window resize to make the grid get the correct size


            //navButtons
            jQuery(grid_selector).jqGrid('navGrid', pager_selector,
                { 	//navbar options
                    edit: false,
                    add: false,
                    del: false,
                    search: true,
                    searchicon: 'ace-icon fa fa-search orange',
                    refresh: true,
                    refreshicon: 'ace-icon fa fa-refresh green',
                    view: false
                },
                {
                    //search form
                    recreateForm: true,
                    afterShowSearch: function (e) {
                        var form = $(e[0]);
                        form.closest('.ui-jqdialog').find('.ui-jqdialog-title').wrap('<div class="widget-header" />')
                        style_search_form(form);
                    },
                    afterRedraw: function () {
                        style_search_filters($(this));
                    }
                    ,
                    multipleSearch: true
                }
            )

            function style_search_filters(form) {
                form.find('.delete-rule').val('X');
                form.find('.add-rule').addClass('btn btn-xs btn-primary');
                form.find('.add-group').addClass('btn btn-xs btn-success');
                form.find('.delete-group').addClass('btn btn-xs btn-danger');
            }
            function style_search_form(form) {
                var dialog = form.closest('.ui-jqdialog');
                var buttons = dialog.find('.EditTable')
                buttons.find('.EditButton a[id*="_reset"]').addClass('btn btn-sm btn-info').find('.ui-icon').attr('class', 'ace-icon fa fa-retweet');
                buttons.find('.EditButton a[id*="_query"]').addClass('btn btn-sm btn-inverse').find('.ui-icon').attr('class', 'ace-icon fa fa-comment-o');
                buttons.find('.EditButton a[id*="_search"]').addClass('btn btn-sm btn-purple').find('.ui-icon').attr('class', 'ace-icon fa fa-search');
            }

            //replace icons with FontAwesome icons like above
            function updatePagerIcons(table) {
                var replacement =
                {
                    'ui-icon-seek-first': 'ace-icon fa fa-angle-double-left bigger-140',
                    'ui-icon-seek-prev': 'ace-icon fa fa-angle-left bigger-140',
                    'ui-icon-seek-next': 'ace-icon fa fa-angle-right bigger-140',
                    'ui-icon-seek-end': 'ace-icon fa fa-angle-double-right bigger-140'
                };
                $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function () {
                    var icon = $(this);
                    var $class = $.trim(icon.attr('class').replace('ui-icon', ''));

                    if ($class in replacement) icon.attr('class', 'ui-icon ' + replacement[$class]);
                })
            }
            //$(document).one('ajaxloadstart.page', function (e) {
            //    $.jgrid.gridDestroy(grid_selector);
            //    $('.ui-jqdialog').remove();
            //});
        });
    </script>
</body>
</html>
